// Ion.Sound | version 3.0.7 | https://github.com/IonDen/ion.sound
!function(t,s,i,e){"use strict";if(t.ion=t.ion||{},!ion.sound){var o=function(s){if(s||(s="undefined"),t.console){console.warn&&"function"==typeof console.warn?console.warn(s):console.log&&"function"==typeof console.log&&console.log(s);var e=i&&i("#debug");if(e&&e.length){var o=e.html();e.html(o+s+"<br/>")}}},n=function(t,s){var i;s=s||{};for(i in t)t.hasOwnProperty(i)&&(s[i]=t[i]);return s};if("function"!=typeof Audio&&"object"!=typeof Audio){var h=function(){o("HTML5 Audio is not supported in this browser")};return ion.sound=h,ion.sound.play=h,ion.sound.stop=h,ion.sound.pause=h,ion.sound.preload=h,ion.sound.destroy=h,void h()}var a,r=/iPad|iPhone|iPod/.test(s.appVersion),p=0,u={},l={};!u.supported&&r?u.supported=["mp3","mp4","aac"]:u.supported||(u.supported=["mp3","ogg","mp4","aac","wav"]);var d=function(t){var s=t.alias||t.name;l[s]||(l[s]=new m(t),l[s].init())};ion.sound=function(t){if(n(t,u),u.path=u.path||"",u.volume=u.volume||1,u.preload=u.preload||!1,u.multiplay=u.multiplay||!1,u.loop=u.loop||!1,u.sprite=u.sprite||null,u.scope=u.scope||null,u.ready_callback=u.ready_callback||null,u.ended_callback=u.ended_callback||null,p=u.sounds.length,!p)return void o("No sound-files provided!");for(a=0;p>a;a++)d(u.sounds[a])},ion.sound.VERSION="3.0.7",ion.sound._method=function(t,s,i){if(s)l[s]&&l[s][t](i);else for(a in l)l.hasOwnProperty(a)&&l[a]&&l[a][t](i)},ion.sound.preload=function(t,s){s=s||{},n({preload:!0},s),ion.sound._method("init",t,s)},ion.sound.destroy=function(t){if(ion.sound._method("destroy",t),t)l[t]=null;else for(a in l)l.hasOwnProperty(a)&&l[a]&&(l[a]=null)},ion.sound.play=function(t,s){ion.sound._method("play",t,s)},ion.sound.stop=function(t,s){ion.sound._method("stop",t,s)},ion.sound.pause=function(t,s){ion.sound._method("pause",t,s)},ion.sound.volume=function(t,s){ion.sound._method("volume",t,s)},i&&(i.ionSound=ion.sound);var c,f=t.AudioContext||t.webkitAudioContext;f&&(c=new f);var m=function(t){this.options=n(u),delete this.options.sounds,n(t,this.options),this.request=null,this.streams={},this.result={},this.ext=0,this.url="",this.loaded=!1,this.decoded=!1,this.no_file=!1,this.file_not_found=!1,this.autoplay=!1};m.prototype={init:function(t){t&&n(t,this.options),this.options.preload&&this.load()},destroy:function(){var t;for(a in this.streams)t=this.streams[a],t&&(t.destroy(),t=null);this.streams={},this.result=null,this.options.buffer=null,this.options=null,this.request&&(this.request.removeEventListener("load",this.ready.bind(this),!1),this.request.removeEventListener("error",this.error.bind(this),!1),this.request.abort(),this.request=null)},createUrl:function(){var t=(new Date).valueOf();this.url=this.options.path+encodeURIComponent(this.options.name)+"."+this.options.supported[this.ext]+"?"+t},load:function(){return this.no_file?void o('No sources for "'+this.options.name+'" sound :('):void(this.request||(this.createUrl(),this.request=new XMLHttpRequest,this.request.open("GET",this.url,!0),this.request.responseType="arraybuffer",this.request.addEventListener("load",this.ready.bind(this),!1),this.request.addEventListener("error",this.error.bind(this),!1),this.request.send()))},reload:function(){this.ext++,this.options.supported[this.ext]?this.load():(this.no_file=!0,o('No sources for "'+this.options.name+'" sound :('))},ready:function(t){return this.result=t.target,4!==this.result.readyState?(this.file_not_found=!0,void this.reload()):200!==this.result.status&&0!==this.result.status?(o(this.url+" was not found on server!"),this.file_not_found=!0,void this.reload()):(this.request.removeEventListener("load",this.ready.bind(this),!1),this.request.removeEventListener("error",this.error.bind(this),!1),this.request=null,this.loaded=!0,this.file_not_found=!1,void this.decode())},decode:function(){c&&c.decodeAudioData(this.result.response,this.setBuffer.bind(this),this.error.bind(this))},setBuffer:function(t){this.options.buffer=t,this.decoded=!0;var s={name:this.options.name,alias:this.options.alias,ext:this.options.supported[this.ext],duration:this.options.buffer.duration};if(this.options.ready_callback&&"function"==typeof this.options.ready_callback&&this.options.ready_callback.call(this.options.scope,s),this.options.sprite)for(a in this.options.sprite)this.options.start=this.options.sprite[a][0],this.options.end=this.options.sprite[a][1],this.streams[a]=new y(this.options,a);else this.streams[0]=new y(this.options);this.autoplay&&(this.autoplay=!1,this.play())},error:function(){this.reload()},play:function(t){if(delete this.options.part,t&&n(t,this.options),this.options.preload===!0&&this.file_not_found===!0&&"function"==typeof t.callback)return t.callback({error:!0,message:"File "+this.url.substring(0,this.url.indexOf("?"))+" was not found"});if(!this.loaded)return this.autoplay=!0,void this.load();if(!this.no_file&&this.decoded)if(this.options.sprite)if(this.options.part)this.streams[this.options.part].play(this.options);else for(a in this.options.sprite)this.streams[a].play(this.options);else this.streams[0].play(this.options)},stop:function(t){if(this.options.sprite)if(t)this.streams[t.part].stop();else for(a in this.options.sprite)this.streams[a].stop();else this.streams[0].stop()},pause:function(t){if(this.options.sprite)if(t)this.streams[t.part].pause();else for(a in this.options.sprite)this.streams[a].pause();else this.streams[0].pause()},volume:function(t){var s;if(t)if(n(t,this.options),this.options.sprite)if(this.options.part)s=this.streams[this.options.part],s&&s.setVolume(this.options);else for(a in this.options.sprite)s=this.streams[a],s&&s.setVolume(this.options);else s=this.streams[0],s&&s.setVolume(this.options)}};var y=function(t,s){this.alias=t.alias,this.name=t.name,this.sprite_part=s,this.buffer=t.buffer,this.start=t.start||0,this.end=t.end||this.buffer.duration,this.multiplay=t.multiplay||!1,this.volume=t.volume||1,this.scope=t.scope,this.ended_callback=t.ended_callback,this.setLoop(t),this.source=null,this.gain=null,this.playing=!1,this.paused=!1,this.time_started=0,this.time_ended=0,this.time_played=0,this.time_offset=0};if(y.prototype={destroy:function(){this.stop(),this.buffer=null,this.source=null,this.gain&&this.gain.disconnect(),this.source&&this.source.disconnect(),this.gain=null,this.source=null},setLoop:function(t){t.loop===!0?this.loop=9999999:"number"==typeof t.loop?this.loop=+t.loop-1:this.loop=!1},update:function(t){this.setLoop(t),"volume"in t&&(this.volume=t.volume)},play:function(t){t&&this.update(t),(this.multiplay||!this.playing)&&(this.gain=c.createGain(),this.source=c.createBufferSource(),this.source.buffer=this.buffer,this.source.connect(this.gain),this.gain.connect(c.destination),this.gain.gain.value=this.volume,this.source.onended=this.ended.bind(this),this._play())},_play:function(){var t,s;return this.paused?(t=this.start+this.time_offset,s=this.end-this.time_offset):(t=this.start,s=this.end),0>=s?void this.clear():("function"==typeof this.source.start?this.source.start(0,t,s):this.source.noteOn(0,t,s),this.playing=!0,this.paused=!1,void(this.time_started=(new Date).valueOf()))},stop:function(){this.playing&&this.source&&("function"==typeof this.source.stop?this.source.stop(0):this.source.noteOff(0)),this.clear()},pause:function(){return this.paused?void this.play():void(this.playing&&(this.source&&this.source.stop(0),this.paused=!0))},ended:function(){this.playing=!1,this.time_ended=(new Date).valueOf(),this.time_played=(this.time_ended-this.time_started)/1e3,this.time_offset+=this.time_played,(this.time_offset>=this.end||this.end-this.time_offset<.015)&&(this._ended(),this.clear(),this.loop&&(this.loop--,this.play()))},_ended:function(){var t={name:this.name,alias:this.alias,part:this.sprite_part,start:this.start,duration:this.end};this.ended_callback&&"function"==typeof this.ended_callback&&this.ended_callback.call(this.scope,t)},clear:function(){this.time_played=0,this.time_offset=0,this.paused=!1,this.playing=!1},setVolume:function(t){this.volume=t.volume,this.gain&&(this.gain.gain.value=this.volume)}},!c){var _=function(){var t,s,i=new Audio,e=i.canPlayType("audio/mpeg"),o=i.canPlayType("audio/ogg"),n=i.canPlayType('audio/mp4; codecs="mp4a.40.2"');for(s=0;s<u.supported.length;s++)t=u.supported[s],e||"mp3"!==t||u.supported.splice(s,1),o||"ogg"!==t||u.supported.splice(s,1),n||"aac"!==t||u.supported.splice(s,1),n||"mp4"!==t||u.supported.splice(s,1);i=null};_(),m.prototype={init:function(t){t&&n(t,this.options),this.inited=!0,this.options.preload&&this.load()},destroy:function(){var t;for(a in this.streams)t=this.streams[a],t&&(t.destroy(),t=null);this.streams={},this.loaded=!1,this.inited=!1},load:function(){var t;if(this.options.preload=!0,this.options._ready=this.ready,this.options._scope=this,this.options.sprite)for(a in this.options.sprite)t=this.options.sprite[a],this.options.start=t[0],this.options.end=t[1],this.streams[a]=new y(this.options,a);else this.streams[0]=new y(this.options)},ready:function(t){if(!this.loaded){this.loaded=!0;var s={name:this.options.name,alias:this.options.alias,ext:this.options.supported[this.ext],duration:t};this.options.ready_callback&&"function"==typeof this.options.ready_callback&&this.options.ready_callback.call(this.options.scope,s),this.autoplay&&(this.autoplay=!1,this.play())}},play:function(t){if(this.inited){if(delete this.options.part,t&&n(t,this.options),console.log(1),!this.loaded)return void(this.options.preload?this.autoplay=!0:(this.autoplay=!0,this.load()));if(this.options.sprite)if(this.options.part)this.streams[this.options.part].play(this.options);else for(a in this.options.sprite)this.streams[a].play(this.options);else this.streams[0].play(this.options)}},stop:function(t){if(this.inited)if(this.options.sprite)if(t)this.streams[t.part].stop();else for(a in this.options.sprite)this.streams[a].stop();else this.streams[0].stop()},pause:function(t){if(this.inited)if(this.options.sprite)if(t)this.streams[t.part].pause();else for(a in this.options.sprite)this.streams[a].pause();else this.streams[0].pause()},volume:function(t){var s;if(t)if(n(t,this.options),this.options.sprite)if(this.options.part)s=this.streams[this.options.part],s&&s.setVolume(this.options);else for(a in this.options.sprite)s=this.streams[a],s&&s.setVolume(this.options);else s=this.streams[0],s&&s.setVolume(this.options)}},y=function(t,s){this.name=t.name,this.alias=t.alias,this.sprite_part=s,this.multiplay=t.multiplay,this.volume=t.volume,this.preload=t.preload,this.path=u.path,this.start=t.start||0,this.end=t.end||0,this.scope=t.scope,this.ended_callback=t.ended_callback,this._scope=t._scope,this._ready=t._ready,this.setLoop(t),this.sound=null,this.url=null,this.loaded=!1,this.start_time=0,this.paused_time=0,this.played_time=0,this.init()},y.prototype={init:function(){this.sound=new Audio,this.sound.volume=this.volume,this.createUrl(),this.sound.addEventListener("ended",this.ended.bind(this),!1),this.sound.addEventListener("canplaythrough",this.can_play_through.bind(this),!1),this.sound.addEventListener("timeupdate",this._update.bind(this),!1),this.load()},destroy:function(){this.stop(),this.sound.removeEventListener("ended",this.ended.bind(this),!1),this.sound.removeEventListener("canplaythrough",this.can_play_through.bind(this),!1),this.sound.removeEventListener("timeupdate",this._update.bind(this),!1),this.sound=null,this.loaded=!1},createUrl:function(){var t=(new Date).valueOf();this.url=this.path+encodeURIComponent(this.name)+"."+u.supported[0]+"?"+t},can_play_through:function(){this.preload&&this.ready()},load:function(){this.sound.src=this.url,this.sound.preload=this.preload?"auto":"none",this.preload&&this.sound.load()},setLoop:function(t){t.loop===!0?this.loop=9999999:"number"==typeof t.loop?this.loop=+t.loop-1:this.loop=!1},update:function(t){this.setLoop(t),"volume"in t&&(this.volume=t.volume)},ready:function(){!this.loaded&&this.sound&&(this.loaded=!0,this._ready.call(this._scope,this.sound.duration),this.end||(this.end=this.sound.duration))},play:function(t){t&&this.update(t),(this.multiplay||!this.playing)&&this._play()},_play:function(){if(this.paused)this.paused=!1;else try{this.sound.currentTime=this.start}catch(t){}this.playing=!0,this.start_time=(new Date).valueOf(),this.sound.volume=this.volume,this.sound.play()},stop:function(){if(this.playing){this.playing=!1,this.paused=!1,this.sound.pause(),this.clear();try{this.sound.currentTime=this.start}catch(t){}}},pause:function(){this.paused?this._play():(this.playing=!1,this.paused=!0,this.sound.pause(),this.paused_time=(new Date).valueOf(),this.played_time+=this.paused_time-this.start_time)},_update:function(){if(this.start_time){var t=(new Date).valueOf(),s=t-this.start_time,i=(this.played_time+s)/1e3;i>=this.end&&this.playing&&(this.stop(),this._ended())}},ended:function(){this.playing&&(this.stop(),this._ended())},_ended:function(){this.playing=!1;var t={name:this.name,alias:this.alias,part:this.sprite_part,start:this.start,duration:this.end};this.ended_callback&&"function"==typeof this.ended_callback&&this.ended_callback.call(this.scope,t),this.loop&&setTimeout(this.looper.bind(this),15)},looper:function(){this.loop--,this.play()},clear:function(){this.start_time=0,this.played_time=0,this.paused_time=0},setVolume:function(t){this.volume=t.volume,this.sound&&(this.sound.volume=this.volume)}}}}}(window,navigator,window.jQuery||window.$);